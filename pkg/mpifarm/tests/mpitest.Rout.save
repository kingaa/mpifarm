
R version 2.12.1 (2010-12-16)
Copyright (C) 2010 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> require(Rmpi)
Loading required package: Rmpi
> require(mpifarm)
Loading required package: mpifarm
> 
> ncpus <- 10
> 
> mpi.spawn.Rslaves(nslaves=ncpus,needlog=T)
	10 slaves are spawned successfully. 0 failed.
master  (rank 0 , comm 1) of size 11 is running on: nyx5000 
slave1  (rank 1 , comm 1) of size 11 is running on: nyx5000 
slave2  (rank 2 , comm 1) of size 11 is running on: nyx5000 
slave3  (rank 3 , comm 1) of size 11 is running on: nyx5000 
... ... ...
slave9  (rank 9 , comm 1) of size 11 is running on: nyx5063 
slave10 (rank 10, comm 1) of size 11 is running on: nyx5063 
> 
> set.seed(1066)
> seeds <- ceiling(runif(n=ncpus,0,2^31))
> x <- mpi.farm({set.seed(seed)},joblist=lapply(seeds,function(x)list(seed=x)),info=F)
> 
> x <- lapply(1:100,function(k)list(a=k,b=rnorm(1)))
> y <- mpi.farm(a+b,x,info=F)
> 
> x <- lapply(1:100,function(k)list(a=k))
> y <- mpi.farm({for (j in 1:10000) j <- j+1; a},x,info=F)
> y <- y[order(as.numeric(names(y)))]
> stopifnot(sum(diff(as.numeric(y))!=1)==0)
> 
> y <- mpi.farm({if(runif(1)<0.1)stop('yikes');a+runif(1)},x,info=F)
Warning messages:
1: mpi.farm: slave 5 reports: Error in eval(expr, envir, enclos) : yikes
 
2: mpi.farm: slave 2 reports: Error in eval(expr, envir, enclos) : yikes
 
3: mpi.farm: slave 5 reports: Error in eval(expr, envir, enclos) : yikes
 
4: mpi.farm: slave 3 reports: Error in eval(expr, envir, enclos) : yikes
 
5: mpi.farm: slave 2 reports: Error in eval(expr, envir, enclos) : yikes
 
6: mpi.farm: slave 4 reports: Error in eval(expr, envir, enclos) : yikes
 
7: mpi.farm: slave 3 reports: Error in eval(expr, envir, enclos) : yikes
 
> warnings()
Warning messages:
1: mpi.farm: slave 5 reports: Error in eval(expr, envir, enclos) : yikes

2: mpi.farm: slave 2 reports: Error in eval(expr, envir, enclos) : yikes

3: mpi.farm: slave 5 reports: Error in eval(expr, envir, enclos) : yikes

4: mpi.farm: slave 3 reports: Error in eval(expr, envir, enclos) : yikes

5: mpi.farm: slave 2 reports: Error in eval(expr, envir, enclos) : yikes

6: mpi.farm: slave 4 reports: Error in eval(expr, envir, enclos) : yikes

7: mpi.farm: slave 3 reports: Error in eval(expr, envir, enclos) : yikes

> 
> seeds <- as.integer(ceiling(runif(n=321,1,2^31)))
> x <- lapply(1:321,function(k)list(a=k,b=10*k,seed=seeds[k]))
> y1 <- mpi.farm({set.seed(seed); a+mean(rnorm(n=b))},joblist=x,checkpoint.file="mpitest.rda",checkpoint=23,info=F)
> load("mpitest.rda")
> file.remove("mpitest.rda")
[1] TRUE
> y2 <- mpi.farm({set.seed(seed); a+mean(rnorm(n=b))},joblist=unfinished,finished=finished,checkpoint.file="mpitest.rda",checkpoint=23,info=F)
> y1 <- y1[order(names(y1))]
> y2 <- y2[order(names(y2))]
> stopifnot(identical(y1,y2))
> 
> x <- lapply(1:50,function(k)list(a=k,b=10*k,done=FALSE))
> y <- mpi.farm(
+               {
+                list(a=a-1,b=b,m=mean(rnorm(n=b)),done=(a<=1))
+                },
+               x,
+               stop.condition=done,
+               checkpoint.file="mpitest.rda",
+               checkpoint=500,
+               info=FALSE
+               )
> 
> file.remove("mpitest.rda")
[1] TRUE
> 
> seeds <- as.integer(ceiling(runif(n=100,1,2^31)))
> x1 <- lapply(1:100,function(k)list(a=k,b=0,done=0,seed=seeds[k]))
> y1 <- mpi.farm(
+                {
+                  set.seed(seed)
+                  list(
+                       a=a,
+                       b=b+rnorm(1),
+                       done=done+1,
+                       seed=seed
+                       )
+                },
+                joblist=x1,
+                stop.condition=((abs(b)>2)|(done>10)),
+                info=F
+                )
> 
> x2 <- lapply(1:100,function(k)list(a=k,b=rnorm(1),seed=seeds[k]))
> z1 <- unlist(mpi.farm({set.seed(seed); a+b},joblist=x2,info=F))
> 
> mpi.close.Rslaves()
[1] 1
> 
> y2 <- mpi.farm(
+                {
+                  set.seed(seed)
+                  list(
+                       a=a,
+                       b=b+rnorm(1),
+                       done=done+1,
+                       seed=seed
+                       )
+                },
+                joblist=x1,
+                stop.condition=((abs(b)>2)|(done>10)),
+                info=F
+                )
> 
> z2 <- unlist(mpi.farm({set.seed(seed); a+b},joblist=x2,info=F))
> 
> y1 <- y1[order(as.numeric(names(y1)))]
> y2 <- y2[order(as.numeric(names(y2)))]
> stopifnot(identical(y1,y2))
> 
> z1 <- z1[order(as.numeric(names(z1)))]
> stopifnot(identical(z1,z2))
> 
> mpi.exit()
[1] "Detaching Rmpi. Rmpi cannot be used unless relaunching R."
> 
